去掉bn之后发现 对抗损失和pixel损失都是nan，内容损失一直在上升
二次退化之后，生成的都是噪声

irrdbnet vs rrdbnet(esrgan)

之前的全连接，我感觉是判别器过于强势，把真实样本和sr都判别成假的。所以我采用了esrgan原版判别器训练150轮。

图片：
流程图
结构图（gen  disc）
残差块图
loss
相对论判别器
学习率动态衰减
随机退化

图表：
采用psnr预训练生成器作为预训练模型。和刚开始就训练的形成对比。

对比实验：
psnr+图片对比：
 gt  | lr biucbic| srcnn | espcnn   | edsr
 gt  | srresnet | srgan | irrdbnet | irsrgan



不能修改损失函数。
不修改判别器。
上采样也不变

              1(done)  2(non)  3(done)   4(non)
-------------|-------|-------|-------|-------
pretrained?  |  x    |   x   |  o    |   o
-------------|-------|-------|-------|-------
random_deg?  |  x    |   o   |  x    |   o
-------------|-------|-------|-------|-------
                fig     fig     fig     fig
                ...     ...    ...     ...

在数据增强阶段引入随机退化

1:IRSRGAN from scratch
2:IRSRGAN from scratch but use random_deg
3:IRSRGAN use pre-trained model(psnr gen) but without random_deg
4:IRSRGAN use pre-trained model(psnr gen) and use random_deg


已训练：
srcnn训练完成150轮次
srgan训练完成150轮次
srresnet训练完成100轮次
irsrgan esrgan原版判别器训练150轮次(1)
edsr训练完成150轮次
ESPCNN 150轮次
irsenet训练完成250轮次
3
2 清空config pre-trained， 在datasets设置random_deg
4 config pre-trained设置250轮次的psnr生成器，在datasets设置random_deg

训练中：


待训练：



1234效果最好的改变其吧batch_size 16, 48 变成5， 6 再测试其参数
如果效果不好，就放弃random_deg吧




Super-resolution (SR) is the process of producing a high-resolution (HR) image from a
given low-resolution (LR) image, which is used in various applications such as surveillance,
microscopy, and medical imaging. It is fundamentally ill-posed because multiple HR images
could yield a single LR image. Therefore, traditional methods used image priors such as
sparsity [32] and edge [26], to limit the solution space.
With the great success of convolutional neural networks (CNN) [31] in various types
of computer vision tasks, current SR studies have attempted to leverage CNNs, and
the resulting learning-based SR approaches outperform traditional ones in accuracy and
efficiency [28]. Then, with the advent of the generative adversarial network (GAN),
learning-based SR methods shifted their focus to producing visually pleasing images by
maximizing the perceptual quality of SR images, rather than maximizing the peak signalto-noise ratio (PSNR) [11] by minimizing the pixel errors of SR images. The most widely
used network for this purpose is Enhanced SR GAN (ESRGAN) [27]. Despite its high performance, there is still room for improvement; consequently, we intend to further improve
the perceptual quality of SR images by improving ESRGAN in three aspects. First, ESRGAN frequently fails to recover local details, resulting in blurry or unnatural visual artifacts,
which are the primary cause of SR image perceptual quality degradation. This could be
because the pretrained VGG network [24] cannot adequately mine potential features of
images, limiting the generator’s reasoning abilities. To overcome this problem, we attempt
to train the generator with an additional perceptual loss estimated via an explicit perceptual
image quality metric. Second, the ESRGAN discriminator focuses on detecting whether a
whole input image is real or fake and does not sufficiently consider local context. We believe
this is a reason why ESRGAN is unable to recover local details. We attempt to modify the
discriminator to extract features of multiple scales and use them together for the real/fake
classification to explicitly encourage the discriminator to fully utilize the global and local
context for better local details. Finally, we discovered that the Leaky ReLU activation function is ineffective for perceptually enhanced SR. Thus, we seek to replace the Leaky ReLU
activation functions in the discriminator with others.
Several studies have been conducted to improve ESRGAN performance by modifying its
network architecture; however, fewer experiments have been conducted to modify the loss
function. In this study, we do not only modify the network architecture but we also strive to
devise a better loss function combination for ESRGAN. To the best of our knowledge, there
have been few previous attempts.
The following are the primary contributions of this study, which focuses on improving
ESRGAN to produce perceptually better SR images:
• We suggest using additional perceptual loss to compensate for the limitation of the
pretrained VGG network in computing perceptual loss when training the ESRGAN generator. To compute the additional loss, we propose using PieAPP, an external perceptual
image quality metric.
• To enhance the local details of SR images, we propose modifying the ESRGAN
discriminator’s structure to extract features of multiple scales.
• To further enhance the perceptual quality of SR images, we propose using the ReLU
activation functions instead of the Leaky ReLU ones in the discriminator.
• The performance of the proposed method is validated on real and computer-generated
(CG) image benchmark datasets in various aspects. Experiments show that when compared to traditional ESRGAN and other state-of-the-art methods, the visual quality and
evaluation metrics are significantly improved.
There have also been “no GAN” methods for perceptually enhanced SR [13]. However,
we concentrate on GAN-based methods in this study